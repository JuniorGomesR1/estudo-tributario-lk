<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise Tributária 2026 - LK Produções</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .kpi-card {
            transition: all 0.3s ease-in-out;
        }
        .nav-button.active {
            background-color: #0f172a;
            color: white;
        }
        .nav-button {
            transition: all 0.2s ease-in-out;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 2.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        .close-button {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            color: #aaa;
            font-size: 1.875rem;
            font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        .llm-button {
            background-color: #0d9488; /* emerald-700 */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
            border: none;
            cursor: pointer;
        }
        .llm-button:hover {
            background-color: #0f766e; /* emerald-800 */
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0d9488;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">

        <header class="text-center mb-12 md:mb-16">
            <h2 class="text-base font-semibold text-sky-600 tracking-wide uppercase">Análise Tributária para 2026</h2>
            <h1 class="text-3xl md:text-5xl font-extrabold tracking-tight text-slate-900 mt-2">LK Produções Culturais e Artísticas LTDA</h1>
            <p class="mt-4 text-lg md:text-xl text-slate-600 max-w-3xl mx-auto">Uma análise comparativa para otimização fiscal e crescimento sustentável.</p>
        </header>

        <section id="highlight" class="mb-12 md:mb-16">
            <div class="bg-white rounded-2xl shadow-lg p-8 text-center border border-slate-200">
                <p class="text-lg font-medium text-slate-600">Economia Anual Projetada com a Migração para o Lucro Real</p>
                <p class="text-5xl md:text-7xl font-extrabold text-emerald-600 my-3">R$ 333.742,00</p>
                <p class="text-base text-slate-500">Isso representa uma redução de <span class="font-bold text-slate-600">4,66%</span> na carga tributária efetiva da sua empresa.</p>
            </div>
        </section>

        <section id="comparison" class="mb-12 md:mb-16">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900">Comparativo dos Regimes</h2>
                <p class="mt-2 text-lg text-slate-600">Selecione um regime para explorar os totais anuais projetados.</p>
            </div>
            
            <div class="flex justify-center mb-8">
                <div class="inline-flex rounded-lg shadow-sm" role="group">
                    <button type="button" id="btn-presumido" class="nav-button active py-3 px-6 text-sm font-medium text-slate-900 bg-white rounded-l-lg border border-slate-200 hover:bg-slate-100 focus:z-10 focus:ring-2 focus:ring-sky-500">
                        Lucro Presumido
                    </button>
                    <button type="button" id="btn-real" class="nav-button py-3 px-6 text-sm font-medium text-slate-900 bg-white rounded-r-lg border-t border-b border-r border-slate-200 hover:bg-slate-100 focus:z-10 focus:ring-2 focus:ring-sky-500">
                        Lucro Real
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                <div id="card-total" class="kpi-card bg-white rounded-2xl shadow-md p-6 border border-slate-200">
                    <h3 class="font-semibold text-slate-900 text-lg">Impostos Totais no Ano</h3>
                    <p id="total-value" class="text-4xl font-extrabold text-sky-600 mt-2"></p>
                </div>
                <div id="card-rate" class="kpi-card bg-white rounded-2xl shadow-md p-6 border border-slate-200">
                    <h3 class="font-semibold text-slate-900 text-lg">Carga Tributária Efetiva</h3>
                    <p id="rate-value" class="text-4xl font-extrabold text-sky-600 mt-2"></p>
                </div>
            </div>
        </section>

        <section id="details" class="mb-12 md:mb-16">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900">Análise Detalhada dos Impostos</h2>
                <p class="mt-2 text-lg text-slate-600">Veja de onde vem a economia. O IRPJ e a CSLL são os principais responsáveis pela redução.</p>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-4 md:p-8 border border-slate-200">
                <div class="chart-container">
                    <canvas id="taxChart"></canvas>
                </div>
            </div>
        </section>

        <section id="glossary" class="mb-12 md:mb-16">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900">Glossário Tributário ✨</h2>
                <p class="mt-2 text-lg text-slate-600">Clique em um termo para obter uma explicação rápida e simples.</p>
            </div>
            <div class="flex flex-wrap justify-center gap-4">
                <button type="button" class="llm-button" data-term="Lucro Presumido">Lucro Presumido</button>
                <button type="button" class="llm-button" data-term="Lucro Real">Lucro Real</button>
                <button type="button" class="llm-button" data-term="IRPJ">IRPJ</button>
                <button type="button" class="llm-button" data-term="CSLL">CSLL</button>
                <button type="button" class="llm-button" data-term="PIS">PIS</button>
                <button type="button" class="llm-button" data-term="COFINS">COFINS</button>
                <button type="button" class="llm-button" data-term="ISS">ISS</button>
            </div>
        </section>

        <section id="conditions" class="mb-12 md:mb-16">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900">Chave para o Sucesso</h2>
                <p class="mt-2 text-lg text-slate-600">A economia projetada depende de um rigoroso controle fiscal. Estas são as duas ações essenciais.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                <div class="bg-white rounded-2xl shadow-md p-6 border border-slate-200">
                    <div class="flex items-center">
                        <span class="text-3xl text-emerald-500 mr-4">&#10144;</span>
                        <h3 class="text-xl font-bold text-slate-900">Emissão de Notas Fiscais</h3>
                    </div>
                    <p class="mt-3 text-slate-600">É imprescindível emitir notas fiscais para absolutamente todos os serviços prestados e locações realizadas. Cada transação deve ser formalizada para compor a receita corretamente.</p>
                </div>
                <div class="bg-white rounded-2xl shadow-md p-6 border border-slate-200">
                    <div class="flex items-center">
                        <span class="text-3xl text-emerald-500 mr-4">&#128229;</span>
                        <h3 class="text-xl font-bold text-slate-900">Exigência de Notas Fiscais</h3>
                    </div>
                    <p class="mt-3 text-slate-600">Exigir e arquivar todas as notas fiscais de serviços e produtos contratados. Elas são a base para a dedução de custos e despesas, o que reduz diretamente o valor dos impostos a pagar.</p>
                </div>
            </div>
        </section>

        <section id="summary-action" class="mb-12 md:mb-16 text-center">
            <button type="button" id="btn-summary" class="llm-button">✨ Gerar Resumo dos Destaques</button>
        </section>

        <section id="next-steps">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900">Próximos Passos</h2>
                <p class="mt-2 text-lg text-slate-600">Sugerimos o seguinte plano de ação para implementar esta otimização.</p>
            </div>
            <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-lg p-8 border border-slate-200">
                <ol class="relative border-l border-slate-200">                  
                    <li class="mb-10 ml-6">            
                        <span class="absolute flex items-center justify-center w-6 h-6 bg-sky-100 rounded-full -left-3 ring-8 ring-white">
                           <span class="font-bold text-sky-800">1</span>
                        </span>
                        <h3 class="flex items-center mb-1 text-lg font-semibold text-slate-900">Validação e Esclarecimentos</h3>
                        <p class="block mb-2 text-sm font-normal leading-none text-slate-500">Aprovação do Planejamento</p>
                        <p class="text-base font-normal text-slate-600">Reunião para discutir os detalhes, sanar todas as dúvidas e obter a aprovação formal para prosseguir.</p>
                    </li>
                    <li class="mb-10 ml-6">
                        <span class="absolute flex items-center justify-center w-6 h-6 bg-sky-100 rounded-full -left-3 ring-8 ring-white">
                            <span class="font-bold text-sky-800">2</span>
                        </span>
                        <h3 class="mb-1 text-lg font-semibold text-slate-900">Cronograma de Transição</h3>
                        <p class="block mb-2 text-sm font-normal leading-none text-slate-500">Plano de Ação Detalhado</p>
                        <p class="text-base font-normal text-slate-600">Elaboração de um plano de ação para a mudança de regime, incluindo todos os ajustes contábeis e fiscais necessários.</p>
                    </li>
                    <li class="mb-10 ml-6">
                        <span class="absolute flex items-center justify-center w-6 h-6 bg-sky-100 rounded-full -left-3 ring-8 ring-white">
                            <span class="font-bold text-sky-800">3</span>
                        </span>
                        <h3 class="mb-1 text-lg font-semibold text-slate-900">Treinamento e Suporte</h3>
                         <p class="block mb-2 text-sm font-normal leading-none text-slate-500">Adequação de Processos</p>
                        <p class="text-base font-normal text-slate-600">Apoio para a equipe interna na adequação aos novos processos de emissão e controle rigoroso de notas fiscais.</p>
                    </li>
                     <li class="ml-6">
                        <span class="absolute flex items-center justify-center w-6 h-6 bg-sky-100 rounded-full -left-3 ring-8 ring-white">
                            <span class="font-bold text-sky-800">4</span>
                        </span>
                        <h3 class="mb-1 text-lg font-semibold text-slate-900">Acompanhamento Contínuo</h3>
                         <p class="block mb-2 text-sm font-normal leading-none text-slate-500">Garantia de Sucesso</p>
                        <p class="text-base font-normal text-slate-600">Nosso suporte contínuo para garantir que a transição seja suave e que os benefícios fiscais sejam plenamente realizados.</p>
                    </li>
                </ol>
            </div>
        </section>

        <footer class="text-center mt-16 pt-8 border-t border-slate-200">
            <p class="text-sm text-slate-500">Análise preparada por <span class="font-semibold">CMA ASSESSORIA CONTABIL LTDA</span></p>
            <p class="text-xs text-slate-400 mt-2">Data da Análise: 15 de agosto de 2025</p>
        </footer>

    </div>

    <!-- LLM Response Modal -->
    <div id="llmModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 id="modalTitle" class="text-2xl font-bold text-slate-900 mb-4"></h3>
            <div id="modalContent" class="text-slate-700 text-base leading-relaxed">
                <div class="loading-spinner"></div> Carregando...
            </div>
        </div>
    </div>

    <script>
        const data = {
            presumido: {
                total: 1482129.13,
                rate: 20.18,
                taxes: {
                    iss: 362428.96,
                    pis: 47115.77,
                    cofins: 217457.38,
                    irpj: 362531.85,
                    irpjAdicional: 217687.90,
                    csll: 274597.26
                }
            },
            real: {
                total: 1148377.84,
                rate: 15.52,
                taxes: {
                    iss: 362887.12,
                    pis: 50093.62,
                    cofins: 227482.78,
                    irpj: 231138.58,
                    irpjAdicional: 130092.39,
                    csll: 138683.15
                }
            }
        };

        const formatCurrency = (value) => `R$ ${value.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        const formatPercent = (value) => `${value.toFixed(2).replace('.', ',')}%`;

        const totalValueEl = document.getElementById('total-value');
        const rateValueEl = document.getElementById('rate-value');
        const btnPresumido = document.getElementById('btn-presumido');
        const btnReal = document.getElementById('btn-real');

        function updateDisplay(regime) {
            totalValueEl.textContent = formatCurrency(data[regime].total);
            rateValueEl.textContent = formatPercent(data[regime].rate);

            if (regime === 'presumido') {
                btnPresumido.classList.add('active');
                btnReal.classList.remove('active');
            } else {
                btnReal.classList.add('active');
                btnPresumido.classList.remove('active');
            }
        }

        btnPresumido.addEventListener('click', () => updateDisplay('presumido'));
        btnReal.addEventListener('click', () => updateDisplay('real'));

        document.addEventListener('DOMContentLoaded', () => {
            updateDisplay('presumido');

            const ctx = document.getElementById('taxChart').getContext('2d');
            const taxChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ISS', 'PIS', 'COFINS', 'IRPJ', 'IRPJ Adic.', 'CSLL'],
                    datasets: [
                        {
                            label: 'Lucro Presumido',
                            data: Object.values(data.presumido.taxes),
                            backgroundColor: 'rgba(56, 189, 248, 0.7)',
                            borderColor: 'rgba(2, 132, 199, 1)',
                            borderWidth: 1,
                            borderRadius: 4
                        },
                        {
                            label: 'Lucro Real',
                            data: Object.values(data.real.taxes),
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: 'rgba(5, 150, 105, 1)',
                            borderWidth: 1,
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + (value / 1000) + 'k';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatCurrency(context.parsed.y);
                                    }
                                    return label;
                                },
                                title: function(tooltipItems) {
                                    const item = tooltipItems[0];
                                    let label = item.chart.data.labels[item.dataIndex];
                                    if (Array.isArray(label)) {
                                      return label.join(' ');
                                    } else {
                                      return label;
                                    }
                                }
                            }
                        }
                    }
                }
            });
        });

        // LLM Integration
        const llmModal = document.getElementById('llmModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        const closeButton = document.querySelector('.close-button');
        const glossaryButtons = document.querySelectorAll('#glossary .llm-button');
        const btnSummary = document.getElementById('btn-summary');

        closeButton.addEventListener('click', () => {
            llmModal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target === llmModal) {
                llmModal.style.display = 'none';
            }
        });

        async function callGeminiAPI(prompt, title) {
            llmModal.style.display = 'flex';
            modalTitle.textContent = title;
            modalContent.innerHTML = '<div class="loading-spinner"></div> Carregando...';

            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
            };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            let retries = 0;
            const maxRetries = 5;
            const baseDelay = 1000;

            while (retries < maxRetries) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429) {
                            const delay = baseDelay * Math.pow(2, retries) + Math.random() * 1000;
                            await new Promise(res => setTimeout(res, delay));
                            retries++;
                            continue;
                        } else {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        modalContent.textContent = result.candidates[0].content.parts[0].text;
                    } else {
                        modalContent.textContent = 'Não foi possível gerar a resposta. Por favor, tente novamente.';
                    }
                    return;

                } catch (error) {
                    modalContent.textContent = 'Ocorreu um erro ao conectar com o serviço. Por favor, tente novamente.';
                    return;
                }
            }
            modalContent.textContent = 'Não foi possível gerar a resposta após várias tentativas. Por favor, tente novamente mais tarde.';
        }

        glossaryButtons.forEach(button => {
            button.addEventListener('click', () => {
                const term = button.dataset.term;
                const prompt = `Explique de forma simples e concisa o que é '${term}' no contexto tributário brasileiro.`;
                callGeminiAPI(prompt, `O que é ${term}?`);
            });
        });

        btnSummary.addEventListener('click', () => {
            const summaryPrompt = `Baseado nos seguintes dados de um estudo tributário para a empresa LK PRODUCOES CULTURAIS E ARTISTICAS LTDA, gere um resumo conciso dos principais destaques e da recomendação final, incluindo a economia projetada e a principal condição para o sucesso.
            - Regime atual: Lucro Presumido (Total: R$ ${data.presumido.total.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}, Carga Efetiva: ${data.presumido.rate.toFixed(2).replace('.', ',')}%)
            - Regime recomendado: Lucro Real (Total: R$ ${data.real.total.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}, Carga Efetiva: ${data.real.rate.toFixed(2).replace('.', ',')}%)
            - Economia anual projetada: R$ ${333742.00.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} (redução de 4,66% na carga)
            - Condição essencial: Rigoroso controle de emissão e exigência de notas fiscais.
            Seja direto e objetivo.`;
            callGeminiAPI(summaryPrompt, 'Resumo dos Destaques do Estudo');
        });
    </script>
</body>
</html>
